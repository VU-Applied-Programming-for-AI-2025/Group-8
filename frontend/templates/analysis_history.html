{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/analysis.css') }}">
{% endblock %}

{% block content %}
<h2>Your Analysis History</h2>
<p class="analysis-subtitle">
    Here you can find your previous analyses based on the symptoms you entered. <br>
    Review your past results and generate personalized meal plans or recipes tailored to your nutritional needs.
</p>
{% if results %}
<div class="analysis-history-grid">
    {% for entry in results | reverse %}
    <div class="analysis-card">
        <p class="analysis-symptoms"><strong>Symptoms:</strong> {{ entry.symptoms }}</p>
        <p class="analysis-def-title"><strong>Deficiency Analysis:</strong></p>
        <ul class="nutrient-list">
            {% for nutrient, details in entry.analyse.items() %}
                {% if nutrient != "Urgency Note" and nutrient != "Additional note" %}
                <li class="nutrient-item">
                    <h4 class="nutrient-name">{{ nutrient }}</h4>
                    <p class="nutrient-detail"><span class="nutrient-label"><b><i>Why:</i></b></span> {{ details.why }}</p>
                    <p class="nutrient-detail"><span class="nutrient-label"><b><i>Foods:</i></b></span> {{ details.foods | join(', ') }}</p>
                    <p class="nutrient-detail"><span class="nutrient-label"><b><i>Tip:</i></b></span> {{ details.tip }}</p>
                </li>
                {% endif %}
            {% endfor %}
        </ul>
        <a href="/recommendations?analysis_id={{ entry.id }}" class="generate-mealplan-btn">Generate Meal Plan</a>
    </div>
    {% endfor %}
</div>
{% else %}
<p>No analysis results saved yet.</p>
{% endif %}
{% endblock %}