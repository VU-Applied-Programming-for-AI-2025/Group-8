<!-- templates/mealplanner.html
<!DOCTYPE html>
<html>
<head>
  <title>Your Meal Plan</title>
</head>
<body>
  <h1>Your Meal Plan</h1>

  {% if message %}
    <p>{{ message }}</p>
  {% elif day_plan %}
    <h2>Day Plan</h2>
    <ul>
      {% for meal in day_plan.meals %}
        <li>
          <strong>{{ meal.title }}</strong> ({{ meal.readyInMinutes }} min) -
          <a href="{{ meal.sourceUrl }}" target="_blank">View Recipe</a>
        </li>
      {% endfor %}
    </ul>

    <h3>Nutrients</h3>
    <ul>
      {% for key, value in day_plan.nutrients.items() %}
        <li>{{ key }}: {{ value }}</li>
      {% endfor %}
    </ul>

  {% elif week_plan %}
    <h2>Week Plan</h2>
    {% for day, data in week_plan.items() %}
      <h3>{{ day.capitalize() }}</h3>
      <ul>
        {% for meal in data.meals %}
          <li>
            <strong>{{ meal.title }}</strong> ({{ meal.readyInMinutes }} min) -
            <a href="{{ meal.sourceUrl }}" target="_blank">View Recipe</a>
          </li>
        {% endfor %}
      </ul>
    {% endfor %}

  {% else %}
    {% for day, meals in mealplan.items() %}
      <h3>Day {{ day }}</h3>
      <ul>
        {% for meal_name, recipe in meals.items() %}
          <li><strong>{{ meal_name.capitalize() }}:</strong>
            <a href="{{ recipe.sourceUrl }}" target="_blank">{{ recipe.title }}</a>
            ({{ recipe.readyInMinutes }} min)
          </li>
        {% endfor %}
      </ul>
    {% endfor %}
  {% endif %}
</body>
</html> -->

{% extends "base.html" %}

{% block title %}Your Meal Plan - NutriSpoon{% endblock %}

{% block content %}
<div class="card">
    <h1 class="card-title">
        {% if mealplan and mealplan.name %}{{ mealplan.name }}
        {% else %}Your Meal Plan{% endif %}
    </h1>
    
    {% if not mealplan and not day_plan and not week_plan %}
    <div class="alert alert-info">
        No meal plan found. Please create one.
    </div>
    {% endif %}
</div>

{# Handle day plans #}
{% if day_plan and day_plan.meals %}
<div class="card">
    <h2>Today's Meals</h2>
    <div class="recipe-grid">
        {% for meal in day_plan.meals %}
        <div class="recipe-card">
            {% if meal.image %}<img src="{{ meal.image }}" alt="{{ meal.title }}" class="recipe-img">{% endif %}
            <div class="recipe-body">
                <h3>{{ meal.title }}</h3>
                {% if meal.readyInMinutes %}<p>Ready in {{ meal.readyInMinutes }} minutes</p>{% endif %}
                {% if meal.sourceUrl %}<a href="{{ meal.sourceUrl }}" target="_blank" class="btn">View Recipe</a>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% if day_plan.nutrients %}
    <div class="nutrition-summary">
        <h3>Nutrition Summary</h3>
        <div class="nutrition-grid">
            {% for nutrient, amount in day_plan.nutrients.items() %}
            <div class="nutrition-item">
                <strong>{{ nutrient|capitalize }}</strong>
                <span>{{ amount|round(1) }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

{# Handle week plans #}
{% elif week_plan %}
<div class="card">
    <h2>Weekly Plan</h2>
    {% for day, meals in week_plan.items() if meals and meals.meals %}
    <div class="day-plan">
        <h3>{{ day|capitalize }}</h3>
        <div class="recipe-grid">
            {% for meal in meals.meals %}
            <div class="recipe-card">
                {% if meal.image %}<img src="{{ meal.image }}" alt="{{ meal.title }}" class="recipe-img">{% endif %}
                <div class="recipe-body">
                    <h3>{{ meal.title }}</h3>
                    {% if meal.readyInMinutes %}<p>Ready in {{ meal.readyInMinutes }} minutes</p>{% endif %}
                    {% if meal.sourceUrl %}<a href="{{ meal.sourceUrl }}" target="_blank" class="btn">View Recipe</a>{% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>

{# Handle custom mealplan format #}
{% elif mealplan and (mealplan.meals or mealplan.nutrients) %}
<div class="card">
    <h2>Your Meal Plan</h2>
    {% if mealplan.meals %}
    <div class="recipe-grid">
        {% for meal in mealplan.meals %}
        <div class="recipe-card">
            {% if meal.image %}<img src="{{ meal.image }}" alt="{{ meal.title }}" class="recipe-img">{% endif %}
            <div class="recipe-body">
                <h3>{{ meal.title }}</h3>
                {% if meal.readyInMinutes %}<p>Ready in {{ meal.readyInMinutes }} minutes</p>{% endif %}
                {% if meal.sourceUrl %}<a href="{{ meal.sourceUrl }}" target="_blank" class="btn">View Recipe</a>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if mealplan.nutrients %}
    <div class="nutrition-summary">
        <h3>Nutrition Summary</h3>
        <div class="nutrition-grid">
            {% for nutrient, amount in mealplan.nutrients.items() %}
            <div class="nutrition-item">
                <strong>{{ nutrient|capitalize }}</strong>
                <span>{{ amount|round(1) }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

{# Fallback if no valid plan found #}
{% else %}
<div class="card">
    <p>No meal plan found or the plan format is not recognized.</p>
    <div class="action-buttons">
        <a href="/recommendations" class="btn btn-accent">Get Recommendations</a>
        <a href="/recommendations/mealplanner/spoonacular" class="btn">Generate Automatic Plan</a>
    </div>
</div>
{% endif %}

<div class="card" style="text-align: center; margin-top: 1rem;">
    <a href="/recommendations" class="btn">Browse Recipes</a>
</div>

<style>
    .recipe-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        margin: 1rem 0;
    }
    
    .recipe-card {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }
    
    .recipe-card:hover {
        transform: translateY(-5px);
    }
    
    .recipe-img {
        width: 100%;
        height: 180px;
        object-fit: cover;
    }
    
    .recipe-body {
        padding: 1rem;
    }
    
    .nutrition-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .nutrition-item {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
    }
    
    .day-plan {
        margin-bottom: 2rem;
    }
    
    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 1rem;
    }
    
    .alert-info {
        background-color: #e7f5ff;
        color: #1864ab;
        padding: 1rem;
        border-radius: 8px;
    }
</style>
{% endblock %}