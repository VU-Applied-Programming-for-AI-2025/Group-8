# BASE
<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{% block title %}My App{% endblock %}</title>
    <style>
        nav {
            background-color: #f0f0f0;
            padding: 10px;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropbtn {
            background-color: transparent;
            border: none;
            font-size: 16px;
            cursor: pointer;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 160px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .dropdown-content a {
            display: block;
            padding: 8px 12px;
            text-decoration: none;
            color: black;
        }

        .dropdown-content a:hover {
            background-color: #e0e0e0;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }
    </style>
</head>

<body>
    <nav>
        <a href="/profile">Profile</a> |
        <div class="dropdown">
            <button class="dropbtn">Nutrients</button>
            <div class="dropdown-content">
                <a href="{{ url_for('nutrients') }}?nutrient=Copper">Copper</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Calcium">Calcium</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Choline">Choline</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Cholesterol">Cholesterol</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Fluoride">Fluoride</a>
                <a href="{{ url_for('nutrients') }}?nutrient=SaturatedFat">Saturated Fat</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminA">Vitamin A</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminC">Vitamin C</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminD">Vitamin D</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminE">Vitamin E</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminK">Vitamin K</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminB1">Vitamin B1</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminB2">Vitamin B2</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminB3">Vitamin B3</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminB5">Vitamin B5</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminB6">Vitamin B6</a>
                <a href="{{ url_for('nutrients') }}?nutrient=VitaminB12">Vitamin B12</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Fiber">Fiber</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Folate">Folate</a>
                <a href="{{ url_for('nutrients') }}?nutrient=FolicAcid">Folic Acid</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Iodine">Iodine</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Iron">Iron</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Magnesium">Magnesium</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Manganese">Manganese</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Phosphorus">Phosphorus</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Potassium">Potassium</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Selenium">Selenium</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Sodium">Sodium</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Sugar">Sugar</a>
                <a href="{{ url_for('nutrients') }}?nutrient=Zinc">Zinc</a>
            </div>

        </div> |
        <a href="/show_favorites">Favorites</a> |
        <a href="{{ url_for('edit_meal_planner') }}" class="btn btn-primary">My Meal Plan</a> |
        <a href="{{ url_for('show_history') }}">View Analysis History</a> |

        <a href="/logout">Logout</a>
    </nav>

    {% block content %}{% endblock %}
</body>

</html>

# HOMEPAGE 
<!-- templates/home.html -->
{% extends "base.html" %}

{% block title %}Homepage - Symptoms Analyzer & Meal Recommendations{% endblock %}

{% block content %}
<form method="POST" action="{{ url_for('search_bar') }}">
    {{ form.hidden_tag() }}
    {{ form.search_bar.label }}
    {{ form.search_bar(size=30, placeholder="Search a nutrient...") }}
    <button type="submit">Search</button>
</form>


<div>
    <h2>Welcome to NutriSpoon{{response.fullname}}</h2>
</div>

<h1>Symptoms analyzer</h1>
<form method="POST" action="/home">
    <label for="symptoms">Enter your symptoms:</label>
    <input type="text" id="symptoms" name="symptoms" required>
    <button type="submit">Analyze</button>
</form>
{% endblock %}

# RESULTS
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Analysis results</title>
</head>

<body>
    <h1>Analysis for {{symptoms}}</h1>
    <div>
        <pre id="analysis">{{ analysis }}</pre>
    </div>

    <div>
        <a href="/recommendations">Get recipes</a>
    </div>

    <script>
        const rawText = document.getElementById("analysis").innerText;

        // Parser for Groq response
        const results = {};
        const lines = rawText.split("\n");

        let currentNutrient = null;

        for (let line of lines) {
            line = line.trim();

            // Nutrient name line e.g., **Magnesium**:
            const nutrientMatch = line.match(/^\*\*(.+?)\*\*:/);
            if (nutrientMatch) {
                currentNutrient = nutrientMatch[1];
                results[currentNutrient] = {
                    why: "",
                    foods: [],
                    tip: ""
                };
                continue;
            }

            // Extract sections under each nutrient
            if (currentNutrient && line.startsWith("- Why:")) {
                results[currentNutrient].why = line.replace("- Why:", "").trim();
            } else if (currentNutrient && line.startsWith("- Foods:")) {
                const foodList = line.replace("- Foods:", "").split(",");
                results[currentNutrient].foods = foodList.map(f => f.trim());
            } else if (currentNutrient && line.startsWith("- Tip:")) {
                results[currentNutrient].tip = line.replace("- Tip:", "").trim();
            }
        }

        // Optional: include urgency note if needed
        const urgencyMatch = rawText.match(/\*\*Urgency Note\*\*: (.+)$/m);
        if (urgencyMatch) {
            results["Urgency Note"] = urgencyMatch[1].trim();
        }

        // Send to Flask
        fetch("/save_results", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(results)
        })
            .then(res => res.text())
            .then(data => {
                console.log("Saved to backend:", data);
            });
    </script>
</body>

</html>

# NUTRIENT INFO PAGE
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ name }} Info</title>
</head>

<body>
    <h1>{{ name }}</h1>

    <h2>Function</h2>
    <p>{{ info.function }}</p>

    <h2>Why It's Important</h2>
    <p>{{ info.why }}</p>

    <h2>Deficiency Symptoms</h2>
    <ul>
        {% for symptom in info.symptoms %}
        <li>{{ symptom }}</li>
        {% endfor %}
    </ul>

    <h2>Top Food Sources</h2>
    <ul>
        {% for food in info.foods %}
        <li>{{ food }}</li>
        {% endfor %}
    </ul>

    <a href="{{ url_for('home') }}">‚Üê Back to nutrient list</a>
</body>

</html>

#PROFILE
<html></html>
<head>
    <title>Your Profile</title>
</head>
<body>
    <h2>Profile for {{ user.name }}</h2>
    {% if message %}
        <p style="color:green;">{{ message }}</p>
    {% endif %}
    <form method="POST">
        <label>Full Name:</label>
        <input type="text" name="name" value="{{ user.name }}"><br>
        <label>Age:</label>
        <input type="number" name="age" value="{{ user.age }}"><br>
        <label>Sex:</label>
        <input type="text" name="sex" value="{{ user.sex }}"><br>
        <label>Height:</label>
        <input type="number" name="height" value="{{ user.height }}"><br>
        <label>Weight:</label>
        <input type="number" name="weight" value="{{ user.weight }}"><br>
        <label>Skin Color:</label>
        <select name="skin_color" required>
            <option value="light" {% if user.skin_color == "light" %}selected{% endif %}>Light</option>
            <option value="medium" {% if user.skin_color == "medium" %}selected{% endif %}>Medium</option>
            <option value="dark" {% if user.skin_color == "dark" %}selected{% endif %}>Dark</option>
        </select><br>
        <label>Country:</label>
        <input type="text" name="country" value="{{ user.country }}"><br>
        <label>Diet:</label>
        <select name="diet" required>
            <option value="none" {% if "none" in user.diet %}selected{% endif %}>None</option>
            <option value="glutenfree" {% if "glutenfree" in user.diet %}selected{% endif %}>Gluten Free</option>
            <option value="ketogenic" {% if "ketogenic" in user.diet %}selected{% endif %}>Ketogenic</option>
            <option value="vegetarian" {% if "vegetarian" in user.diet %}selected{% endif %}>Vegetarian</option>
            <option value="lacto-vegetarian" {% if "lacto-vegetarian" in user.diet %}selected{% endif %}>Lacto-Vegetarian</option>
            <option value="ovo-vegetarian" {% if "ovo-vegetarian" in user.diet %}selected{% endif %}>Ovo-Vegetarian</option>
            <option value="vegan" {% if "vegan" in user.diet %}selected{% endif %}>Vegan</option>
            <option value="pescetarian" {% if "pescetarian" in user.diet %}selected{% endif %}>Pescetarian</option>
            <option value="paleo" {% if "paleo" in user.diet %}selected{% endif %}>Paleo</option>
            <option value="primal" {% if "primal" in user.diet %}selected{% endif %}>Primal</option>
            <option value="lowfodmap" {% if "lowfodmap" in user.diet %}selected{% endif %}>Low FODMAP</option>
            <option value="whole30" {% if "whole30" in user.diet %}selected{% endif %}>Whole30</option>
        </select><br>
        <label>Medications (comma separated):</label>
        <input type="text" name="medication" value="{{ ', '.join(user.medication) }}"><br>
        <label>Existing conditions (comma separated):</label>
        <input type="text" name="existing_conditions" value="{{ ', '.join(user.existing_conditions) }}"><br>
        <label>Allergies (comma separated):</label>
        <input type="text" name="allergies" value="{{ ', '.join(user.allergies) }}"><br>
        <label>Password:</label>
        <input type="password" name="password" value="{{ user.password }}"><br>
        <button type="submit">Update Profile</button>
    </form>
    <a href="{{ url_for('home') }}">Back to Home</a>
</body>
</html>